name: Copilot Setup Steps

on:
  workflow_dispatch:
  push:
    branches: [main, develop]

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    permissions:
      contents: read
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install Node.js dependencies
        run: npm ci
      
      - name: Install Python dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Install development dependencies
        run: |
          pip install -e ".[dev]"
      
      - name: Export environment variables
        run: |
          echo "HEADY_VERSION=1.0.0" >> $GITHUB_ENV
          echo "NODE_ENV=development" >> $GITHUB_ENV
          echo "PYTHONPATH=$GITHUB_WORKSPACE" >> $GITHUB_ENV
      
      - name: Verify installation
        run: |
          echo "Node.js version: $(node --version)"
          echo "npm version: $(npm --version)"
          echo "Python version: $(python --version)"
          echo "pip version: $(pip --version)"
          echo "Environment variables set:"
          echo "  HEADY_VERSION=$HEADY_VERSION"
          echo "  NODE_ENV=$NODE_ENV"
          echo "  PYTHONPATH=$PYTHONPATH"
      
      - name: Validate project structure
        run: |
          echo "Validating project structure..."
          test -f heady-manager.js || (echo "Missing heady-manager.js" && exit 1)
          test -f admin_console.py || (echo "Missing admin_console.py" && exit 1)
          test -d heady_project || (echo "Missing heady_project directory" && exit 1)
          echo "âœ“ Project structure validated"
      
      - name: Setup complete
        run: |
          echo "ðŸŽ‰ Copilot environment setup complete!"
          echo "All dependencies installed and environment configured."
