version: '3.8'

services:
  # MCP Filesystem Server
  mcp-filesystem:
    image: node:18-alpine
    container_name: heady-mcp-filesystem
    labels:
      - "com.docker.compose.project=HeadyMCP"
      - "com.docker.compose.service=mcp-filesystem"
    volumes:
      - /Users/erich/Heady:/workspace
      - ./node_modules:/app/node_modules
    working_dir: /app
    command: npx -y @modelcontextprotocol/server-filesystem /workspace
    environment:
      - NODE_ENV=production
      - MCP_HOST=headymcp.com
      - MCP_PORT=3700
    restart: unless-stopped
    networks:
      - mcp-network

  # MCP PostgreSQL Server
  mcp-postgres:
    image: node:18-alpine
    container_name: heady-mcp-postgres
    labels:
      - "com.docker.compose.project=HeadyMCP"
      - "com.docker.compose.service=mcp-postgres"
    depends_on:
      - postgres
    volumes:
      - ./node_modules:/app/node_modules
    working_dir: /app
    command: npx -y @modelcontextprotocol/server-postgres
    environment:
      - DATABASE_URL=postgresql://postgres:password@postgres:5432/heady
      - NODE_ENV=production
      - MCP_HOST=headymcp.com
      - MCP_PORT=3700
    restart: unless-stopped
    networks:
      - mcp-network

  # MCP Memory Server
  mcp-memory:
    image: node:18-alpine
    container_name: heady-mcp-memory
    labels:
      - "com.docker.compose.project=HeadyMCP"
      - "com.docker.compose.service=mcp-memory"
    volumes:
      - ./mcp-data:/data
      - ./node_modules:/app/node_modules
    working_dir: /app
    command: npx -y @modelcontextprotocol/server-memory
    environment:
      - NODE_ENV=production
      - MEMORY_STORAGE_PATH=/data
      - MCP_HOST=headymcp.com
      - MCP_PORT=3700
    restart: unless-stopped
    networks:
      - mcp-network

  # MCP Fetch Server
  mcp-fetch:
    image: node:18-alpine
    container_name: heady-mcp-fetch
    labels:
      - "com.docker.compose.project=HeadyMCP"
      - "com.docker.compose.service=mcp-fetch"
    volumes:
      - ./node_modules:/app/node_modules
    working_dir: /app
    command: npx -y @modelcontextprotocol/server-fetch
    environment:
      - NODE_ENV=production
      - MCP_HOST=headymcp.com
      - MCP_PORT=3700
    restart: unless-stopped
    networks:
      - mcp-network

  # PostgreSQL Database for MCP
  postgres:
    image: postgres:15-alpine
    container_name: heady-postgres
    labels:
      - "com.docker.compose.project=HeadyMCP"
      - "com.docker.compose.service=postgres"
    environment:
      - POSTGRES_DB=heady
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - mcp-network

  # Redis for MCP caching
  redis:
    image: redis:7-alpine
    container_name: heady-redis
    labels:
      - "com.docker.compose.project=HeadyMCP"
      - "com.docker.compose.service=redis"
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped
    networks:
      - mcp-network

volumes:
  postgres_data:
  redis_data:

networks:
  mcp-network:
    external: true
    name: heady-apps-network
    driver: bridge
